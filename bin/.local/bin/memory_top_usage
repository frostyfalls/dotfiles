#!/usr/bin/env python3

import subprocess

MAX_COMMAND_LENGTH = 35


ps_output = subprocess.check_output(["ps", "-eo", "size,command", "--sort=-size"]).decode()
lines = ps_output.strip().split("\n")[1:]

processes = {}
for line in lines:
    size, command = line.strip().split(None, 1)
    command = command.split("-")[0].strip()
    processes[command] = processes.get(command, 0) + int(size)

sorted_processes = sorted(processes.items(), key=lambda x: x[1], reverse=True)
for command, memory in sorted_processes[:10]:
    if memory >= 1024 * 1024:
        memory_display = memory / (1024 * 1024)
        memory_unit = "GB"
    elif memory >= 1024:
        memory_display = memory / 1024
        memory_unit = "MB"
    else:
        memory_display = memory
        memory_unit = "KB"

    print(f"{memory_display:>6.2f} {memory_unit:<4} {(command[:MAX_COMMAND_LENGTH-3] + "...") if len(command) > MAX_COMMAND_LENGTH else command}")
