#!/bin/sh

AUDIO_SINK="@DEFAULT_AUDIO_SINK@"
AUDIO_LIMIT=1
AUDIO_STEP=2

case "$BLOCK_BUTTON" in
    1) wpctl set-mute "$AUDIO_SINK" toggle ;;
    3) setsid -f "$TERMINAL" -e pulsemixer ;;
    4)
        wpctl set-mute "$AUDIO_SINK" 0
        wpctl set-volume -l "$AUDIO_LIMIT" "$AUDIO_SINK" "$AUDIO_STEP"%+
        ;;
    5)
        wpctl set-mute "$AUDIO_SINK" 0
        wpctl set-volume -l "$AUDIO_LIMIT" "$AUDIO_SINK" "$AUDIO_STEP"%-
        ;;
    6) setsid -f "$TERMINAL" -e "$EDITOR" "$0" ;;
esac

get_volume_icon() {
    case "$1" in
    [6-9][0-9] | 100) printf '\n' ;;
    [3-5][0-9]) printf '\n' ;;
    [0-2][0-9]) printf '\n' ;;
    *) exit 1 ;;
    esac
}

value=$(wpctl get-volume "$AUDIO_SINK")
value=${value##Volume: }
value=${value%%.*}${value##*.}

case "$value" in
*MUTED*)
    icon=""
    value=${value%% \[MUTED\]}
    ;;
esac

value=${value#0}
value=${value#0}
value=$((value))

[ -z "$icon" ] && icon=$(get_volume_icon "$value")

printf '%s %s%%\n' "$icon" "$value"
