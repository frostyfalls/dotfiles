#!/bin/sh

set -eu

PREFIX="${PASSWORD_STORE_DIR:-$HOME/.password-store}"

notify() { notify-send --urgency=low 'Password Store' "$@"; }
prompt() { fuzzel -d -p 'pass '; }
clean_entry() { entry="${1#"$PREFIX"/}" && echo "${entry%.gpg}"; }
copy_entry() { case "$1" in TOTP/*) pass otp -c "$1" ;; *) pass show -c "$1" ;; esac }

selected="$(find "$PREFIX" -type f -name '*.gpg' | while IFS= read -r entry; do clean_entry "$entry"; done | sort -f | prompt)"
copy_entry "$selected" && notify "Copied <b>$selected</b> to the clipboard."
