#!/bin/sh

set -eu

KANSHI_CONFIG_FILE="${XDG_CONFIG_HOME:-$HOME/.config}/kanshi/config"

notify() { notify-send "Output" "$@"; }

profile="$(while IFS= read -r line; do
    case "$line" in
    profile*)
        profile="${line#profile \"}"
        profile="${profile%\"*}"
        echo "$profile"
        ;;
    *) ;;
    esac
done <"$KANSHI_CONFIG_FILE" | fuzzel --dmenu --prompt='output ')"

[ -z "$profile" ] && return

if kanshictl switch "$profile" 2>/dev/null; then
    notify "Output profile switched to <b>$profile</b>."
else
    notify "Failed to switch output profile to <b>$profile</b>."
fi
