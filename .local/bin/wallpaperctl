#!/bin/sh
# shellcheck disable=SC1091,SC2015

set -eu

[ -f "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs" ] && . "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs"

WALLPAPERS_PATH="${XDG_WALLPAPERS_DIR:-${XDG_PICTURES_DIR:-$HOME/Pictures}}"
DESTINATION_PATH="${XDG_DATA_HOME:-$HOME/.local/share}/wallpaper"
DISPLAY_MODE="fill"

clean() { pkill swaybg || :; }
run() { swaybg -m "$1" -i "$2"; }
viewer() { nsxiv -ot "$@"; }

case "${1:-run}" in
clean) clean ;;
run) clean && run "$DISPLAY_MODE" "$DESTINATION_PATH" ;;
set) selected="${2:-$(viewer "$WALLPAPERS_PATH")}" && [ -n "$selected" ] && cp "$selected" "$DESTINATION_PATH" ;;
*) exit 1 ;;
esac
