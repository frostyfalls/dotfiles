#!/bin/sh

set -eu

[ -f "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs" ] && . "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs"

OUTPUT_PATH="${XDG_SCREENSHOTS_DIR:-${XDG_PICTURES_DIR:-$HOME}}/$(date "+%Y-%m-%d_%H-%M-%S").png"
NOTIFY_MESSAGE="Saved to <b>${OUTPUT_PATH##*/}</b> and copied to the clipboard."

alias notify='notify-send "Screenshot"'
alias prompt='fuzzel -d -p "screenshot "'

selection="${1:-full}"
while :; do
    case "$selection" in
    full)
        grim "$OUTPUT_PATH" && wl-copy -t image/png <"$OUTPUT_PATH" && notify "$NOTIFY_MESSAGE"
        ;;
    select)
        grim -g "$(slurp)" "$OUTPUT_PATH" && wl-copy -t image/png <"$OUTPUT_PATH" && notify "$NOTIFY_MESSAGE"
        ;;
    menu)
        case "$(printf 'Fullscreen\nSelection' | prompt)" in
        Fullscreen) selection="full" ;;
        Selection) selection="select" ;;
        *) exit 1 ;;
        esac
        continue
        ;;
    *)
        exit 1
        ;;
    esac
    exit 0
done
