#!/bin/sh

set -eu

# shellcheck disable=SC1091
[ -f "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs" ] && . "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs"
OUTPUT_DIRECTORY=${XDG_SCREENSHOTS_DIR:-${XDG_PICTURES_DIR:-$HOME}}
FILENAME_BASE=
FILENAME_DATE_FORMAT="%Y-%m-%d_%H-%M-%S"

NOTIFY=1
COPY=1
SAVE=1

screenshot_type=$1

if [ "$SAVE" ]; then
    FILE_PATH=${FILE_PATH:-$OUTPUT_DIRECTORY/$FILENAME_BASE$(date "+$FILENAME_DATE_FORMAT").png}
else
    FILE_PATH="/tmp/${0##*/}-$!.png"
fi

case $screenshot_type in
    select) grim -qug "$(slurp || exit 1)" "$FILE_PATH" ;;
    full) grim -qu "$FILE_PATH" ;;
    *) exit 1 ;;
esac

[ "$NOTIFY" ] && notify-send "${0##*/}" "Screenshot taken"
[ "$COPY" ] && wl-copy --type image/png "$FILE_PATH"
[ "$SAVE" ] || rm "$FILE_PATH"
