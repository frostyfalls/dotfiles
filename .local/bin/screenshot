#!/bin/sh

set -eu

# shellcheck disable=SC1091
[ -f "${XDG_CONFIG_HOME:-${HOME}/.config}/user-dirs.dirs" ] && . "${XDG_CONFIG_HOME:-${HOME}/.config}/user-dirs.dirs"

FILENAME_DATE_FORMAT="%Y-%m-%d_%H-%M-%S"
OUTPUT_PATH="${XDG_SCREENSHOTS_DIR:-${XDG_PICTURES_DIR:-$HOME}}/$(date "+$FILENAME_DATE_FORMAT").png"
NOTIFY_MESSAGE="Saved to <b>${OUTPUT_PATH##*/}</b> and copied to the clipboard."

notify() { notify-send -u low -r 1001 "Screenshot" "$@"; }

case "${1:-full}" in
full)
    maim -u | tee "$OUTPUT_PATH" | xclip -sel clip -t image/png &&
        notify "$NOTIFY_MESSAGE"
    ;;
select)
    maim -us | tee "$OUTPUT_PATH" | xclip -sel clip -t image/png &&
        notify "$NOTIFY_MESSAGE"
    ;;
*)
    exit 1
    ;;
esac
