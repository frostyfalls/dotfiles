#!/bin/sh
# shellcheck disable=SC1091

set -eu

[ -f "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs" ] && . "${XDG_CONFIG_HOME:-$HOME/.config}/user-dirs.dirs"

OUTPUT_PATH="${XDG_SCREENSHOTS_DIR:-${XDG_PICTURES_DIR:-$HOME}}/$(date "+%Y-%m-%d_%H-%M-%S").png"
NOTIFY_MESSAGE="Saved to <b>${OUTPUT_PATH##*/}</b> and copied to the clipboard."

notify() { notify-send --urgency=low 'Screenshot' "$@"; }

case "${1:-full}" in
full) grim "$OUTPUT_PATH" && wl-copy --type=image/png <"$OUTPUT_PATH" && notify "$NOTIFY_MESSAGE" ;;
select) grim -g "$(slurp)" "$OUTPUT_PATH" && wl-copy --type=image/png <"$OUTPUT_PATH" && notify "$NOTIFY_MESSAGE" ;;
*) exit 1 ;;
esac
