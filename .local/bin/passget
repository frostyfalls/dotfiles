#!/bin/sh

set -eu

PREFIX=${PASSWORD_STORE_DIR:-$HOME/.password-store}
TYPE=0

case "${1:-}" in
-t | --type)
    TYPE=1
    shift
    ;;
*) ;;
esac

password=$(find "$PREFIX" -type f -name '*.gpg' | while IFS= read -r file; do
    password="${file#"$PREFIX"/}"
    password="${password%.gpg}"
    printf '%s\n' "$password"
done | sort -f | fuzzel -d -p "pass: ")

[ -z "$password" ] && exit

if [ "$TYPE" -eq 0 ]; then
    pass show -c "$password" 2>/dev/null
else
    pass show "$password" | head -n1 | wtype -
fi
