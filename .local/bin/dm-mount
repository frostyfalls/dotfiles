#!/bin/sh

set -eu

DISK_BY_LABEL="/dev/disk/by-label"
UDEVIL_CMD="mount"

while getopts ':u' opt; do
    case "$opt" in
    u) UDEVIL_CMD="umount" ;;
    *) ;;
    esac
done

disks=$(find "$DISK_BY_LABEL"/* | cut -d'/' -f5)
selection=$(printf '%s' "$disks" | fuzzel --dmenu --prompt="$UDEVIL_CMD ")
[ -z "$selection" ] && return
path="$DISK_BY_LABEL/$selection"

urgency="normal"
title="Mount"
message=$(udevil "$UDEVIL_CMD" "$path" 2>&1) || {
    urgency="critical"
    title="Mount Error"
}
[ -n "$message" ] && notify-send -u "$urgency" "$title" "$message"
