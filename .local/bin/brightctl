#!/bin/sh

set -eu

notify() {
    notify-send \
        --hint=string:x-dunst-stack-tag:brightness \
        "$@"
}

get_device_name() {
    case "${1:-}" in
    intel_backlight | acpi_video0) echo "Display" ;;
    *::kbd_backlight) echo "Keyboard" ;;
    *) return 1 ;;
    esac
}

set_volume() {
    device="$1"
    amount="$2"
    name="$(get_device_name "${device}")" || return 1

    IFS=',' read -r _ _ _ brightness _ <<EOF
$(brightnessctl --machine-readable --device="${device}" set "${amount}")
EOF
    brightness=${brightness%\%}

    notify \
        --hint=int:value:"${brightness}" \
        "${name} Brightness"
}

case "${1:-}" in
set) set_volume "${1:-intel_backlight}" "${2:-100}" ;;
*) exit 1 ;;
esac
