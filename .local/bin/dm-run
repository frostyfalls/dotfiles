#!/bin/sh

set -eu

FUNCTIONS_FILE="$XDG_CONFIG_HOME/dm-run/config"

prompt() { fuzzel -d -p 'run '; }

selected=$(while IFS='=' read -r display _; do
    [ "$display" = "" ] && continue
    display=$(echo "$display" | sed 's/^[ \t]*//;s/[ \t]*$//')
    if [ -z "$display" ] || [ "${display%"${display#?}"}" = "#" ]; then
        continue
    fi
    echo "$display"
done <"$FUNCTIONS_FILE" | prompt)

[ -z "$selected" ] && return

while IFS='=' read -r display cmd; do
    [ "$display" = "$selected" ] && exec $cmd
done <"$FUNCTIONS_FILE"
