#!/bin/sh

set -eu

PASSWORD_STORE_DIR="${PASSWORD_STORE_DIR:-$HOME/.password-store}"

notify() { notify-send "Password Store" "$@"; }
prompt() { fuzzel -d -p 'pass '; }

entry="$(find "$PASSWORD_STORE_DIR" -type f -name '*.gpg' | while IFS= read -r line; do
    entry="${line#"$PASSWORD_STORE_DIR"/}"
    entry="${entry%.gpg}"
    echo "$entry"
done | sort -f | prompt)"

[ -z "$entry" ] && return

pass show -c "$entry" && notify "Copied <b>$entry</b> to the clipboard."
